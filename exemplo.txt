st.markdown("### üéØ Atividade Pr√°tica")
with st.container():
    st.info("**Tarefa:** Criar a primeira vers√£o do Prompt Mestre")

st.markdown("### Building The Master Prompt")
st.markdown("#### Preencha o formul√°rio abaixo para criar seu Prompt Mestre personalizado")

# Criar diret√≥rio para salvar os arquivos se n√£o existir
os.makedirs(DOCS_DIR, exist_ok=True)

with st.form("form_prompt_mestre"):
    objetivo = st.text_area("1. Objetivo do Prompt", height=80)
    persona_selecionada = st.multiselect("2. Persona do Assistente", [
        "Secret√°rio(a) do psic√≥logo",
        "Assistente do educador f√≠sico",
        "Auxiliar jur√≠dico do advogado",
        "Coordenador de atendimento do empres√°rio"
    ])
    persona_descricao = st.text_area("Descreva a persona", height=70)
    estilo_texto = st.text_area("3. Estilo de Linguagem", height=70)
    estilo_selecionado = st.multiselect("Escolha op√ß√µes de estilo", [
        "Formal e t√©cnico", "Leve e motivacional", "Cient√≠fico e objetivo", "Acolhedor e emp√°tico"
    ])
    publico_selecionado = st.multiselect("4. P√∫blico-Alvo", [
        "Pacientes", "Clientes", "Equipes multiprofissionais", "Alunos"
    ])
    tipo_linguagem = st.selectbox("5. Tipo de Linguagem", [
        "Simples e direta", "Detalhada e explicativa", "T√©cnica", "Criativa", "L√∫dica"
    ])
    contexto = st.text_area("6. Contexto Profissional e de Vida", height=80)
    faixa_etaria = st.selectbox("7. Faixa Et√°ria do P√∫blico-Alvo", [
        "Crian√ßas (0-12)", "Adolescentes (13-17)", "Adultos (18-59)", "Idosos (60+)"
    ])
    formato_saida = st.selectbox("8. Formato de Sa√≠da Esperado", [
        "Texto corrido", "Lista de etapas", "Roteiro", "Tabela", "JSON ou estrutura de dados"
    ])
    inspiracoes = st.text_area("9. Inspira√ß√µes e Refer√™ncias", height=70)
    restricoes_selecionadas = st.multiselect("10. Restri√ß√µes", [
        "Evitar linguagem diagn√≥stica", "Respeitar anonimato",
        "N√£o gerar interpreta√ß√µes jur√≠dicas", "Priorizar inclus√£o e acessibilidade"
    ])
    restricao_adicional = st.text_area("Outras restri√ß√µes", height=70)
    sobre_voce = st.text_area("11. Sobre Voc√™ (inclua seu nome completo)", height=80, help="Seu nome ser√° usado para identificar o arquivo")
    biopsicossocial = st.text_area("12. Quest√£o Biopsicossocial", height=70)
    atividades = st.text_area("13. Tr√™s atividades a automatizar", height=70)

    submitted = st.form_submit_button("üì® Finalizar e Gerar Documento")

if submitted:
    if not sobre_voce.strip():
        st.error("Por favor, preencha seu nome no campo 'Sobre Voc√™'")
    else:
        nome = sobre_voce.strip().split("\n")[0].split(" ")[0]
        
        # Criar o documento Word
        doc = Document()
        doc.add_heading(f"Prompt Mestre - {nome}", 0)
        
        # Adicionar conte√∫do ao documento
        campos = {
            "Objetivo do Prompt": objetivo,
            "Persona Selecionada": ", ".join(persona_selecionada),
            "Descri√ß√£o da Persona": persona_descricao,
            "Estilo de Linguagem": estilo_texto,
            "Estilo Selecionado": ", ".join(estilo_selecionado),
            "P√∫blico-Alvo": ", ".join(publico_selecionado),
            "Tipo de Linguagem": tipo_linguagem,
            "Contexto Profissional e de Vida": contexto,
            "Faixa Et√°ria": faixa_etaria,
            "Formato de Sa√≠da": formato_saida,
            "Inspira√ß√µes": inspiracoes,
            "Restri√ß√µes Selecionadas": ", ".join(restricoes_selecionadas),
            "Outras Restri√ß√µes": restricao_adicional,
            "Sobre Voc√™": sobre_voce,
            "Quest√£o Biopsicossocial": biopsicossocial,
            "Atividades a Automatizar": atividades
        }
        
        for titulo, conteudo in campos.items():
            doc.add_heading(titulo, level=1)
            doc.add_paragraph(conteudo if conteudo else "-")
            doc.add_paragraph()  # Espa√ßo entre se√ß√µes

        # Salvar o documento
        nome_arquivo = DOCS_DIR / f"PromptMestre_{nome}.docx"
        doc.save(str(nome_arquivo))
        
        # Mostrar mensagem de sucesso e bot√£o de download
        st.success(f"‚úÖ Documento gerado com sucesso para {nome}!")
        
        with open(nome_arquivo, "rb") as file:
            st.download_button(
                label="üì• Baixar Prompt Mestre (DOCX)",
                data=file,
                file_name=f"PromptMestre_{nome}.docx",
                mime="application/vnd.openxmlformats-officedocument.wordprocessingml.document"
            )

# Bot√µes de navega√ß√£o
st.markdown("---")
col1, col2, col3 = st.columns(3)

with col1:
    if st.button("‚¨ÖÔ∏è Aula Anterior"):
        st.switch_page("pages/03_fundamentos_prompt.py")    
        
with col3:
    if st.button("Pr√≥xima Aula ‚û°Ô∏è"):
        st.switch_page("pages/05_personalizacao.py")

# Progresso
st.progress(4/12, text="Progresso: 33.33%") 